<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="jkm">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
        
        
        
            <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
        
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://goldenkm.github.io/2024/08/18/os-lab6-challenge-experiment-report/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="Lab6æŒ‘æˆ˜æ€§ä»»åŠ¡å®éªŒæŠ¥å‘Šå…·ä½“ä»£ç è§: BUAA-OS-2023-Spring  ä¸€ã€å„é¡¹ä»»åŠ¡å®ç°æ€è·¯å¿…åšéƒ¨åˆ†1.1 å®ç°ä¸€è¡Œå¤šå‘½ä»¤åœ¨Lab6çš„æŒ‘æˆ˜æ€§ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬æ¥è§¦åˆ°çš„ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯å®ç°â€œï¼›â€çš„åŠŸèƒ½ï¼Œè¿™ä¸€åŠŸèƒ½ä¸ç®—å¤ªéš¾ï¼Œæ•´ä½“ä¸Šå‚è€ƒå®éªŒä»£ç ä¸­ç®¡é“çš„å®ç°å³å¯ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ 12345678910111213case &#x27;;&#x27;:	&#x2F;&#x2F;lab6-challenge	child &#x3D; for">
<meta property="og:type" content="article">
<meta property="og:title" content="OS-Lab6-æŒ‘æˆ˜æ€§ä»»åŠ¡ å®éªŒæŠ¥å‘Š">
<meta property="og:url" content="http://goldenkm.github.io/2024/08/18/OS-Lab6-Challenge-Experiment-Report/index.html">
<meta property="og:site_name" content="jkm&#39;s blog">
<meta property="og:description" content="Lab6æŒ‘æˆ˜æ€§ä»»åŠ¡å®éªŒæŠ¥å‘Šå…·ä½“ä»£ç è§: BUAA-OS-2023-Spring  ä¸€ã€å„é¡¹ä»»åŠ¡å®ç°æ€è·¯å¿…åšéƒ¨åˆ†1.1 å®ç°ä¸€è¡Œå¤šå‘½ä»¤åœ¨Lab6çš„æŒ‘æˆ˜æ€§ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬æ¥è§¦åˆ°çš„ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯å®ç°â€œï¼›â€çš„åŠŸèƒ½ï¼Œè¿™ä¸€åŠŸèƒ½ä¸ç®—å¤ªéš¾ï¼Œæ•´ä½“ä¸Šå‚è€ƒå®éªŒä»£ç ä¸­ç®¡é“çš„å®ç°å³å¯ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ 12345678910111213case &#x27;;&#x27;:	&#x2F;&#x2F;lab6-challenge	child &#x3D; for">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/1.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/12.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/2.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/3.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/4.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/5.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/9.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/10.jpeg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/8.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/11.png">
<meta property="article:published_time" content="2024-08-17T16:41:00.000Z">
<meta property="article:modified_time" content="2024-08-24T14:49:25.651Z">
<meta property="article:author" content="Kaiming Jin">
<meta property="article:tag" content="C">
<meta property="article:tag" content="OS">
<meta property="article:tag" content="å®éªŒæŠ¥å‘Š">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/1.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/avatar.jpg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpg">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/avatar.jpg">
    <!--- Page Info-->
    
    <title>
        
            OS-Lab6-æŒ‘æˆ˜æ€§ä»»åŠ¡ å®éªŒæŠ¥å‘Š -
        
        JKM&#39;s Blog
    </title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/fonts/Chillax/chillax.css">

    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/assets/build/styles.css">
    

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/fonts/GeistMono/geist-mono.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/fonts/Geist/geist.css">
    <!--- Font Part-->
    
        <link href="" rel="stylesheet">
    
    
    
    

    
        <script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/libs/anime.min.js"></script>
    

    <script id="hexo-configurations">
    window.config = {"hostname":"goldenkm.github.io","root":"/","language":"zh-CN","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"æ¨èé˜…è¯»","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/home-banner1.jpg","dark":"/images/home-banner3.jpg"},"title":"Hi!","subtitle":{"text":["ä½ å¥½ğŸ‘‹","Welcome to my blog!"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":true,"family":null,"url":null,"color":"black"},"social_links":{"enable":true,"style":"default","links":{"github":"https://github.com/goldenkm","instagram":null,"zhihu":null,"twitter":null,"email":"894082241@qq.com"},"qrs":{"weixin":"/images/wechat-code.jpg"}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.6.4","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"icon":"fa-solid fa-tags","path":"/tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-list"},"Shuoshuo":{"icon":"fa-solid fa-comment-dots","path":"/shuoshuo"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/goldenkm","Friends":"/links"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"info","announcement":null,"show_on_mobile":true,"links":{"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-list"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Shuoshuo":{"icon":"fa-solid fa-comment-dots","path":"/shuoshuo"}}},"article_date_format":"auto","categories":{"enable":true,"limit":30},"tags":{"enable":true,"limit":30}},"footerStart":"2022/8/17 11:45:14"};
    window.lang_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/fontawesome/fontawesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/fontawesome/brands.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/fontawesome/solid.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/fontawesome/regular.min.css">
    
    
    
    
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
<!--        <span class="swup-progress-icon">-->
<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
<!--        </span>-->
    
</div>



    <style>
    :root {
        --preloader-background-color: #fff;
        --preloader-text-color: #000;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --preloader-background-color: #202124;
            --preloader-text-color: #fff;
        }
    }

    @media (prefers-color-scheme: light) {
        :root {
            --preloader-background-color: #fff;
            --preloader-text-color: #000;
        }
    }

    @media (max-width: 600px) {
        .ml13 {
            font-size: 2.6rem !important; /* Adjust this value as needed */
        }
    }

    .preloader {
        display: flex;
        flex-direction: column;
        gap: 1rem; /* Tailwind 'gap-4' is 1rem */
        align-items: center;
        justify-content: center;
        position: fixed;
        padding: 12px;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 100vh; /* 'h-screen' is 100% of the viewport height */
        background-color: var(--preloader-background-color);
        z-index: 1100; /* 'z-[1100]' sets the z-index */
        transition: opacity 0.2s ease-in-out;
    }

    .ml13 {
        font-size: 3.2rem;
        /* text-transform: uppercase; */
        color: var(--preloader-text-color);
        letter-spacing: -1px;
        font-weight: 500;
        font-family: 'Chillax-Variable', sans-serif;
        text-align: center;
    }

    .ml13 .word {
        display: inline-flex;
        flex-wrap: wrap;
        white-space: nowrap;
    }

    .ml13 .letter {
        display: inline-block;
        line-height: 1em;
    }
</style>

<div class="preloader">
    <h2 class="ml13">
        JKM&#39;s Blog
    </h2>
    <script>
        var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });

        var animation = anime.timeline({loop: true})
            .add({
                targets: '.ml13 .letter',
                translateY: [40,0],
                translateZ: 0,
                opacity: [0,1],
                filter: ['blur(5px)', 'blur(0px)'], // Starting from blurred to unblurred
                easing: "easeOutExpo",
                duration: 1400,
                delay: (el, i) => 300 + 30 * i,
            }).add({
                targets: '.ml13 .letter',
                translateY: [0,-40],
                opacity: [1,0],
                filter: ['blur(0px)', 'blur(5px)'], // Ending from unblurred to blurred
                easing: "easeInExpo",
                duration: 1200,
                delay: (el, i) => 100 + 30 * i,
                complete: function() {
                    hidePreloader(); // Call hidePreloader after the animation completes
                }
            });

        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            setTimeout(hidePreloader, 5000); // Call hidePreloader after 5000 milliseconds if not already called by animation
        });

        function hidePreloader() {
            var preloader = document.querySelector('.preloader');
            preloader.style.opacity = '0';
            setTimeout(function () {
                preloader.style.display = 'none';
            }, 200);
        }
    </script>
</div>

<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container px-6 md:px-12">

    <div class="navbar-content ">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                JKM&#39;s Blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    é¦–é¡µ
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    å½’æ¡£
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/tags"
                                        >
                                    <i class="fa-solid fa-tags fa-fw"></i>
                                    æ ‡ç­¾
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/categories"
                                        >
                                    <i class="fa-regular fa-list fa-fw"></i>
                                    åˆ†ç±»
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/shuoshuo"
                                        >
                                    <i class="fa-solid fa-comment-dots fa-fw"></i>
                                    è¯´è¯´
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    å…³äº
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a href="/about">
                                                    ME
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/goldenkm">
                                                    GITHUB
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a href="/links">
                                                    å‹æƒ…é“¾æ¥
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-screen w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                é¦–é¡µ
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                å½’æ¡£
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/tags"
                        >
                            <span>
                                æ ‡ç­¾
                            </span>
                            
                                <i class="fa-solid fa-tags fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/categories"
                        >
                            <span>
                                åˆ†ç±»
                            </span>
                            
                                <i class="fa-regular fa-list fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/shuoshuo"
                        >
                            <span>
                                è¯´è¯´
                            </span>
                            
                                <i class="fa-solid fa-comment-dots fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-About"
                        >
                            <span>
                                å…³äº
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-About">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/about">ME</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/goldenkm">GITHUB</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/links">å‹æƒ…é“¾æ¥</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    
                    
                    
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">16</div>
        <div class="label text-third-text-color text-sm">æ ‡ç­¾</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">3</div>
        <div class="label text-third-text-color text-sm">åˆ†ç±»</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">15</div>
        <div class="label text-third-text-color text-sm">æ–‡ç« </div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container flex relative justify-between box-border w-full h-full">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                <div class="w-full flex items-center pt-6 justify-start">
                    <h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">OS-Lab6-æŒ‘æˆ˜æ€§ä»»åŠ¡ å®éªŒæŠ¥å‘Š</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">jkm</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv2</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-08-18 00:41</span>
        <span class="mobile">2024-08-18 00:41</span>
        <span class="hover-info">åˆ›å»º</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-08-24 22:49:25</span>
            <span class="mobile">2024-08-24 22:49:25</span>
            <span class="hover-info">æ›´æ–°</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/%E4%B8%93%E4%B8%9A%E8%AF%BE/">ä¸“ä¸šè¯¾</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/C/">C</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/OS/">OS</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/">å®éªŒæŠ¥å‘Š</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h1 id="Lab6æŒ‘æˆ˜æ€§ä»»åŠ¡å®éªŒæŠ¥å‘Š"><a href="#Lab6æŒ‘æˆ˜æ€§ä»»åŠ¡å®éªŒæŠ¥å‘Š" class="headerlink" title="Lab6æŒ‘æˆ˜æ€§ä»»åŠ¡å®éªŒæŠ¥å‘Š"></a>Lab6æŒ‘æˆ˜æ€§ä»»åŠ¡å®éªŒæŠ¥å‘Š</h1><p>å…·ä½“ä»£ç è§: <a class="link"   target="_blank" rel="noopener" href="https://github.com/goldenkm/BUAA-OS-2023-Spring" >BUAA-OS-2023-Spring <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="ä¸€ã€å„é¡¹ä»»åŠ¡å®ç°æ€è·¯"><a href="#ä¸€ã€å„é¡¹ä»»åŠ¡å®ç°æ€è·¯" class="headerlink" title="ä¸€ã€å„é¡¹ä»»åŠ¡å®ç°æ€è·¯"></a>ä¸€ã€å„é¡¹ä»»åŠ¡å®ç°æ€è·¯</h2><h3 id="å¿…åšéƒ¨åˆ†"><a href="#å¿…åšéƒ¨åˆ†" class="headerlink" title="å¿…åšéƒ¨åˆ†"></a>å¿…åšéƒ¨åˆ†</h3><h4 id="1-1-å®ç°ä¸€è¡Œå¤šå‘½ä»¤"><a href="#1-1-å®ç°ä¸€è¡Œå¤šå‘½ä»¤" class="headerlink" title="1.1 å®ç°ä¸€è¡Œå¤šå‘½ä»¤"></a>1.1 å®ç°ä¸€è¡Œå¤šå‘½ä»¤</h4><p>åœ¨Lab6çš„æŒ‘æˆ˜æ€§ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬æ¥è§¦åˆ°çš„ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯å®ç°â€œï¼›â€çš„åŠŸèƒ½ï¼Œè¿™ä¸€åŠŸèƒ½ä¸ç®—å¤ªéš¾ï¼Œæ•´ä½“ä¸Šå‚è€ƒå®éªŒä»£ç ä¸­ç®¡é“çš„å®ç°å³å¯ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&#x27;;&#x27;</span>:	<span class="comment">//lab6-challenge</span></span><br><span class="line">	child = fork();</span><br><span class="line">	*rightpipe = child;</span><br><span class="line">	<span class="comment">//é‡ç‚¹åœ¨äºè®©çˆ¶äº²æ‰§è¡Œåˆ†å·å³è¾¹çš„æŒ‡ä»¤ã€‚</span></span><br><span class="line">	<span class="keyword">if</span> (child &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		wait(child);</span><br><span class="line">		<span class="keyword">return</span> parsecmd(argv, rightpipe);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (child == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> argc;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		user_panic(<span class="string">&quot;fork error!\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">break</span>;</span><br></pre></td></tr></table></figure></div>
<p>è¿™ä¸€åŠŸèƒ½éœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ä¸ºäº†<strong>ä¾æ¬¡</strong>å®ç°åˆ†å·ä¸¤ä¾§çš„å‘½ä»¤ï¼Œéœ€è¦è®©çˆ¶è¿›ç¨‹æ‰§è¡Œåˆ†å·å³è¾¹çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”ç­‰å¾…å­è¿›ç¨‹ç»“æŸæ‰æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡waitå‡½æ•°æ¥æ§åˆ¶æŒ‡ä»¤æ‰§è¡Œçš„é¡ºåºã€‚</p>
<h4 id="1-2-å®ç°åå°ä»»åŠ¡"><a href="#1-2-å®ç°åå°ä»»åŠ¡" class="headerlink" title="1.2 å®ç°åå°ä»»åŠ¡"></a>1.2 å®ç°åå°ä»»åŠ¡</h4><p>ç¬¬äºŒä¸ªä»»åŠ¡æ˜¯å®ç°â€œ&amp;â€ï¼Œå®ç°æ€è·¯æ˜¯è®©çˆ¶è¿›ç¨‹æ‰§è¡Œ&amp;å³ä¾§çš„æŒ‡ä»¤ï¼Œå­è¿›ç¨‹æ‰§è¡Œ&amp;å·¦ä¾§çš„æŒ‡ä»¤ï¼Œä½†æ­¤æ—¶çˆ¶è¿›ç¨‹æ— éœ€ç­‰å¾…å­è¿›ç¨‹ã€‚shellçš„è¯»å–æœºåˆ¶æ˜¯è¯»åˆ°ä¸‹ä¸€æ¡ä¹‹å‰ä¸€ç›´å¿™ç­‰ï¼Œå…¶ä½™è¿›ç¨‹éƒ½è¢«é˜»å¡ï¼Œæ‰€ä»¥å¯ä»¥è®©çˆ¶è¿›ç¨‹ä¸è¢«é˜»å¡ä½ï¼Œç»§ç»­æ‰§è¡Œä¹‹åè¯»å…¥çš„å‘½ä»¤ï¼Œå­è¿›ç¨‹ç»§ç»­æ‰§è¡Œè¯¥å‘½ä»¤ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//parse_cmd()</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;&amp;&#x27;</span>: </span><br><span class="line">	child = fork();</span><br><span class="line">	<span class="keyword">if</span> (child == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> argc;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (child &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> parsecmd(argv, <span class="number">0</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		user_panic(<span class="string">&quot;fork error!\n&quot;</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="1-3-å®ç°å¼•å·æ”¯æŒ"><a href="#1-3-å®ç°å¼•å·æ”¯æŒ" class="headerlink" title="1.3 å®ç°å¼•å·æ”¯æŒ"></a>1.3 å®ç°å¼•å·æ”¯æŒ</h4><p>è¯¥ä»»åŠ¡çš„å®ç°æ€è·¯æ˜¯_gettoken()å‡½æ•°ä¸­å¯¹å¼•å·è¿›è¡Œç‰¹åˆ¤ï¼Œå½“è¯»åˆ°å³å¼•å·æ—¶ç»“æŸç‰¹åˆ¤ï¼Œè¿‡ç¨‹æœ‰ç‚¹åƒä¸€é“å¤§ä¸€çš„ç¨‹è®¾é¢˜ã€‚ä¸ºäº†å‘çœŸå®çš„linuxçš„shellé æ‹¢ï¼Œæˆ‘åŠ å…¥äº†è½¬ä¹‰ç¬¦çš„å®ç°ï¼Œä¸»è¦éš¾ç‚¹åœ¨äºå¯¹äºå¾ªç¯ç»“æŸæ¡ä»¶çš„åˆ¤æ–­æ¯”è¾ƒå¤æ‚ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™é‡Œçš„ä»£ç ä¿éšœäº†ä¸ä¼šå› ä¸ºè¯†åˆ«åˆ°è¢«è½¬ä¹‰è¿‡çš„åŒå¼•å·è€Œç»“æŸï¼ˆå¦‚ï¼š\â€œ)ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//_gettoken()</span></span><br><span class="line"><span class="comment">//å®ç°å¼•å·æ”¯æŒ</span></span><br><span class="line"><span class="keyword">if</span> (*s == <span class="string">&#x27;\&quot;&#x27;</span>) &#123;</span><br><span class="line">    *p1 = ++s;</span><br><span class="line">	<span class="keyword">while</span> ((*s != <span class="string">&#x27;\&quot;&#x27;</span> || *(s<span class="number">-1</span>) == <span class="string">&#x27;\\&#x27;</span>) </span><br><span class="line">                &amp;&amp; (*s != <span class="string">&#x27;\&quot;&#x27;</span> || *(s<span class="number">-1</span>) != <span class="string">&#x27;\\&#x27;</span> || *(s<span class="number">-2</span>) != <span class="string">&#x27;\\&#x27;</span>)) &#123;</span><br><span class="line">		s++;</span><br><span class="line">	&#125;</span><br><span class="line">	*s++ = <span class="number">0</span>;	<span class="comment">//å¿…é¡»è¦å°å¥½å­—ç¬¦ä¸²</span></span><br><span class="line">	*p2 = s;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;w&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>åŒæ—¶éœ€è¦ä¿®æ”¹parse_cmdçš„éƒ¨åˆ†ï¼š</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//parse_cmd()</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line">	<span class="keyword">if</span> (argc &gt;= MAXARGS) &#123;</span><br><span class="line">		debugf(<span class="string">&quot;too many arguments\n&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	remove_slash(t);</span><br><span class="line">	argv[argc++] = t;</span><br><span class="line"></span><br><span class="line"><span class="comment">//remove_slash()</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">remove_slash</span><span class="params">(<span class="type">char</span> *t)</span> &#123;</span><br><span class="line">	<span class="type">char</span> tmp[<span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="type">int</span> length = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; t[i]; i++) &#123;</span><br><span class="line">            <span class="comment">//å°†éœ€è¦è½¬ä¹‰çš„å­—ç¬¦åˆ—ä¸¾åœ¨è¿™é‡Œ</span></span><br><span class="line">	    <span class="type">int</span> flag = (t[i+<span class="number">1</span>] == <span class="string">&#x27;\&#x27;&#x27;</span>) || (t[i+<span class="number">1</span>] == <span class="string">&#x27;\&quot;&#x27;</span>);</span><br><span class="line">	    <span class="keyword">if</span> (t[i] == <span class="string">&#x27;\\&#x27;</span> &amp;&amp; t[i+<span class="number">1</span>] == <span class="string">&#x27;\\&#x27;</span>) &#123;</span><br><span class="line">	    	tmp[length++] = <span class="string">&#x27;\\&#x27;</span>;</span><br><span class="line">	    	i++;</span><br><span class="line">	    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t[i] == <span class="string">&#x27;\\&#x27;</span> &amp;&amp; flag) &#123;</span><br><span class="line">	    	<span class="keyword">continue</span>;</span><br><span class="line">	    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	    	tmp[length++] = t[i];</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	tmp[length] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">	<span class="built_in">strcpy</span>(t, tmp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘æ–°å†™äº†ä¸€ä¸ªremove_slashçš„å‡½æ•°ç”¨äºå»é™¤è½¬ä¹‰ç¬¦ã€‚è¿™é‡Œæˆ‘åªè€ƒè™‘äº†å•åŒå¼•å·ä¸\çš„è½¬ä¹‰ï¼Œä½†ä¹Ÿç•™å‡ºäº†æ—¥åæ·»åŠ è½¬ä¹‰ç¬¦çš„ç©ºé—´ï¼Œå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§ã€‚</p>
<h4 id="1-4-å®ç°é”®å…¥å‘½ä»¤æ—¶ä»»æ„ä½ç½®çš„ä¿®æ”¹"><a href="#1-4-å®ç°é”®å…¥å‘½ä»¤æ—¶ä»»æ„ä½ç½®çš„ä¿®æ”¹" class="headerlink" title="1.4 å®ç°é”®å…¥å‘½ä»¤æ—¶ä»»æ„ä½ç½®çš„ä¿®æ”¹"></a>1.4 å®ç°é”®å…¥å‘½ä»¤æ—¶ä»»æ„ä½ç½®çš„ä¿®æ”¹</h4><p>ä»è¿™ä¸€è¦æ±‚å¼€å§‹Lab6çš„æŒ‘æˆ˜æ€§ä»»åŠ¡çš„éš¾åº¦é™¡ç„¶è€Œå‡ï¼Œå› ä¸ºæ¶‰åŠåˆ°äº†ä¸å¤–è®¾çš„äº¤äº’ã€‚é¦–å…ˆï¼Œç»è¿‡æŸ¥é˜…èµ„æ–™ä¸è¯•éªŒï¼Œä¸Šä¸‹å·¦å³å››ä¸ªé”®çš„asciiç ä¸æˆ‘ä»¬å¹³æ—¶æ¥è§¦åˆ°çš„å­—ç¬¦ä¸å¤ªä¸€æ ·ï¼Œè¿™å››ä¸ªé”®åˆ†ä¸ºäº†ä¸‰ä¸ªå€¼è¡¨ç¤ºï¼Œåˆ†åˆ«æ˜¯27+91+65&#x2F;66&#x2F;67&#x2F;68ï¼ˆä¾æ¬¡å¯¹åº”ä¸Šä¸‹å·¦å³ï¼‰ã€‚<br>å…·ä½“çš„å®ç°æ€è·¯æ˜¯ï¼šä¸ºäº†å®ç°åœ¨ä¸åŒä½ç½®çš„å¢åŠ åˆ é™¤ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªpointerï¼Œä¸“é—¨è®°å½•å½“å‰å…‰æ ‡æ‰€åœ¨çš„ä½ç½®ï¼Œæ¯æ¬¡åœ¨pointerå¤„è¯»å…¥å­—ç¬¦ã€‚è‹¥æ˜¯è¯»å…¥å­—ç¬¦çš„ä½ç½®æœ‰å­—ç¬¦ï¼Œå³å¯¹åº”å¢åŠ å­—ç¬¦çš„æƒ…å†µï¼Œå°±æŠŠä»pointeråˆ°ç»“å°¾çš„å†…å®¹éƒ½å…ˆæš‚å­˜èµ·æ¥ï¼Œå†ç”¨strcatæŠŠè¿™å‡ éƒ¨åˆ†æ‹¼æ¥èµ·æ¥ã€‚åŒæ—¶éœ€è¦æ³¨æ„å…‰æ ‡ä½ç½®çš„æŒªåŠ¨ï¼Œæˆ‘çš„æ–¹æ³•æ˜¯è¾“å‡ºç©ºæ ¼æ¶ˆé™¤æ§åˆ¶å°çš„è¾“å‡ºï¼Œç„¶åè¾“å‡ºé€€æ ¼é”®å°†å…‰æ ‡ä½ç½®æŒªå›æ¥ã€‚åˆ é™¤çš„æƒ…å†µä¸ä¹‹ç±»ä¼¼ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¯»å…¥å·¦å³é”®æ—¶çš„æƒ…å†µ</span></span><br><span class="line"><span class="comment">//readline()</span></span><br><span class="line"><span class="keyword">if</span> (buf[i+<span class="number">2</span>] == <span class="number">68</span>) &#123; <span class="comment">//left</span></span><br><span class="line">    <span class="keyword">if</span> (pointer &gt; <span class="number">0</span>) &#123; <span class="comment">//æ³¨æ„å·¦å³ç§»åŠ¨å…‰æ ‡éœ€è¦æœ‰ä¸ªæé™</span></span><br><span class="line">    	pointer--;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    	<span class="built_in">printf</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (buf[i+<span class="number">2</span>] == <span class="number">67</span>) &#123; <span class="comment">//right</span></span><br><span class="line">    <span class="keyword">if</span> (cmd[pointer] != <span class="string">&#x27;\0&#x27;</span>) &#123;</span><br><span class="line">        pointer++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\b&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***********æ­£å¸¸è¯»å…¥å­—ç¬¦***********/</span></span><br><span class="line"><span class="keyword">if</span> (cmd[pointer] != <span class="number">0</span>) &#123;    <span class="comment">//å¢åŠ å­—ç¬¦</span></span><br><span class="line">    <span class="type">char</span> tmp[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> length = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = pointer; j &lt; n; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cmd[j] == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        tmp[length++] = cmd[j];</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; &quot;</span>);    <span class="comment">//æ¸…ç©ºæ§åˆ¶å°</span></span><br><span class="line">    &#125;</span><br><span class="line">    tmp[length] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; length; j++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\b&quot;</span>);   <span class="comment">//å°†å…‰æ ‡æŒªå›æ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">    cmd[pointer++] = buf[i];    </span><br><span class="line">    cmd[pointer] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="built_in">strcat</span>(cmd, tmp);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; length; j++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, tmp[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; length; j++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\b&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    cmd[pointer++] = buf[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***********è¯»å…¥åˆ é™¤é”®***********/</span></span><br><span class="line"><span class="keyword">if</span> (buf[i] == <span class="number">127</span>) &#123; <span class="comment">//å®ç°åˆ é™¤åŠŸèƒ½ï¼Œä¸æ’å…¥ç±»ä¼¼</span></span><br><span class="line">    <span class="type">char</span> tmp[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (pointer == <span class="number">0</span>) &#123; <span class="comment">//ä¸èƒ½æ— æ­¢å¢ƒçš„åˆ é™¤</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\b &quot;</span>);</span><br><span class="line">    <span class="type">int</span> length = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = pointer; j &lt; n; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cmd[j] == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        tmp[length++] = cmd[j];</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    tmp[length] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= length; j++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\b&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    cmd[--pointer] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="built_in">strcat</span>(cmd, tmp);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; length; j++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, tmp[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; length; j++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\b&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="1-5-å®ç°ç¨‹åºåç§°ä¸­-b-çš„çœç•¥"><a href="#1-5-å®ç°ç¨‹åºåç§°ä¸­-b-çš„çœç•¥" class="headerlink" title="1.5 å®ç°ç¨‹åºåç§°ä¸­ .b çš„çœç•¥"></a>1.5 å®ç°ç¨‹åºåç§°ä¸­ .b çš„çœç•¥</h4><p>è¿™ä¸€ä»»åŠ¡ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦å½“æ‰“ä¸å¼€æ–‡ä»¶æ—¶åœ¨æ–‡ä»¶ååé¢åŠ ä¸Šâ€œ.bâ€œé‡æ–°æ‰“å¼€ä¸€éå³å¯ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user/spawn.c</span></span><br><span class="line"><span class="keyword">if</span> ((fd = open(prog, O_RDONLY)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="type">char</span> prog1[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;; </span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; prog[i] != <span class="number">0</span>; i++) &#123;</span><br><span class="line">    prog1[i] = prog[i];</span><br><span class="line">    &#125;</span><br><span class="line">    prog1[i] = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">    prog1[i+<span class="number">1</span>] = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">    prog1[i+<span class="number">2</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> ((fd = open(prog1, O_RDONLY)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> fd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="1-6-å®ç°æ›´ä¸°å¯Œçš„å‘½ä»¤"><a href="#1-6-å®ç°æ›´ä¸°å¯Œçš„å‘½ä»¤" class="headerlink" title="1.6 å®ç°æ›´ä¸°å¯Œçš„å‘½ä»¤"></a>1.6 å®ç°æ›´ä¸°å¯Œçš„å‘½ä»¤</h4><h5 id="1-6-1-tree"><a href="#1-6-1-tree" class="headerlink" title="1.6.1 tree"></a>1.6.1 tree</h5><p>å®ç°treeå‘½ä»¤å¯ä»¥å‚è€ƒå®éªŒä»£ç é‡Œçš„ls.cæ–‡ä»¶ï¼Œå¾ªç¯è¯»ç›®å½•é‡Œçš„æ–‡ä»¶ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯ä¸ªç›®å½•ï¼Œå°±é€’å½’è¯»å–ï¼Œå¹¶è®°å½•é€’å½’çš„å±‚æ•°ä»¥å½¢å¼åŒ–è¾“å‡ºã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user/tree.c</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">tree</span><span class="params">(<span class="type">char</span> *path, <span class="type">int</span> level)</span> &#123;</span><br><span class="line">    <span class="type">int</span> fd, n;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">File</span> <span class="title">f</span>;</span></span><br><span class="line">    <span class="keyword">if</span> ((fd = open(path, O_RDONLY)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    	user_panic(<span class="string">&quot;open %s: %d&quot;</span>, path, fd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ((n = readn(fd, &amp;f, <span class="keyword">sizeof</span> f)) == <span class="keyword">sizeof</span> f) &#123;</span><br><span class="line">    	<span class="keyword">if</span> (f.f_name[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; level; i++) &#123;</span><br><span class="line">                debugf(<span class="string">&quot;   &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            debugf(<span class="string">&quot;|--&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (f.f_type == FTYPE_REG) &#123;</span><br><span class="line">            	debugf(<span class="string">&quot;%s\n&quot;</span>, f.f_name);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (f.f_type == FTYPE_DIR) &#123;</span><br><span class="line">                debugf(<span class="string">&quot;%s\n&quot;</span>, f.f_name);</span><br><span class="line">                <span class="type">char</span> newPath[<span class="number">1024</span>];</span><br><span class="line">                <span class="built_in">strcpy</span>(newPath, path);</span><br><span class="line">                <span class="built_in">strcat</span>(newPath, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">                <span class="built_in">strcat</span>(newPath, f.f_name);</span><br><span class="line">                tree(newPath, level+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h5 id="1-6-2-mkdir"><a href="#1-6-2-mkdir" class="headerlink" title="1.6.2 mkdir"></a>1.6.2 mkdir</h5><p>mkdirçš„å®ç°æ€è·¯ï¼šå…ˆå°†è·¯å¾„é‡Œçš„æ–‡ä»¶æ‹†åˆ†ï¼Œå­˜è¿›äºŒç»´æ•°ç»„ï¼›å†åˆ†æˆä¸¤ç§æƒ…å†µï¼Œè¯¥æŒ‡ä»¤å¯ä»¥æ·»åŠ -pçš„é€‰é¡¹ï¼Œå¦‚æœæ·»åŠ -på°±å¯ä»¥å®ç°å¦‚æœé‡åˆ°ä¸å­˜åœ¨çš„ç›®å½•å°±åˆ›å»ºï¼Œåä¹‹åˆ™ä¼šæŠ¥é”™ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> flag[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">dir_is_exist</span><span class="params">(<span class="type">char</span> *path)</span> &#123;</span><br><span class="line">	<span class="type">int</span> fd;</span><br><span class="line">	fd = open(path, O_RDONLY);</span><br><span class="line">	close(fd);</span><br><span class="line">	<span class="keyword">return</span> fd &gt;= <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mkdir</span><span class="params">(<span class="type">char</span> *path)</span> &#123;</span><br><span class="line">    <span class="type">int</span> r, i, count = <span class="number">0</span>;;</span><br><span class="line">    <span class="type">char</span> dirs[<span class="number">50</span>][<span class="number">1024</span>];</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> pathLen = <span class="built_in">strlen</span>(path);</span><br><span class="line">    <span class="keyword">while</span> (i &lt; pathLen) &#123;</span><br><span class="line">        <span class="type">int</span> length = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (path[i] != <span class="string">&#x27;/&#x27;</span> &amp;&amp; path[i]) &#123;</span><br><span class="line">            dirs[count][length++] = path[i++];</span><br><span class="line">        &#125;</span><br><span class="line">        dirs[count++][length] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">char</span> now[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">File</span> *<span class="title">f</span>;</span></span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; count) &#123;</span><br><span class="line">        <span class="built_in">strcat</span>(now, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="built_in">strcat</span>(now, dirs[i]);</span><br><span class="line">        <span class="keyword">if</span> (flag[<span class="string">&#x27;p&#x27;</span>]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!dir_is_exist(now)) &#123;</span><br><span class="line">                create(now, FTYPE_DIR);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == count - <span class="number">1</span>) &#123; <span class="comment">//æœ€åä¸€ä¸ªdirï¼Œè¦åˆ›å»º</span></span><br><span class="line">                create(now, FTYPE_DIR);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!dir_is_exist(now)) &#123;</span><br><span class="line">                    debugf(<span class="string">&quot;mkdir fail\n&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">usage</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;usage: mkdir [-p] [file...]\n&quot;</span>);</span><br><span class="line">	<span class="built_in">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line">	ARGBEGIN &#123;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		usage();</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;p&#x27;</span>:</span><br><span class="line">		flag[(u_char)ARGC()]++;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ARGEND</span><br><span class="line">	<span class="title function_">for</span> <span class="params">(<span class="type">int</span> i = <span class="number">0</span>; i &lt; argc; i++)</span> &#123;</span><br><span class="line">		<span class="type">char</span> *path = parse_path(argv[i]);</span><br><span class="line">		mkdir(path);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h5 id="1-6-3-touch"><a href="#1-6-3-touch" class="headerlink" title="1.6.3 touch"></a>1.6.3 touch</h5><p>touchçš„å®ç°ä¸mkdirç±»ä¼¼ï¼Œåªæ˜¯å°†åˆ›å»ºçš„æ–‡ä»¶çš„ç±»å‹æ”¹ä¸ºæ™®é€šæ–‡ä»¶ã€‚è¿™é‡Œåªæ”¾ä¸Šæ ¸å¿ƒåŠŸèƒ½ä»£ç ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">touch</span><span class="params">(<span class="type">char</span> *path)</span> &#123;</span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    <span class="type">char</span> realPath[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (path[<span class="number">0</span>] != <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        realPath[<span class="number">0</span>] = <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcat</span>(realPath, path);</span><br><span class="line">    r = create(realPath, FTYPE_REG);</span><br><span class="line">    <span class="keyword">if</span> (r &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        debugf(<span class="string">&quot;touch fail\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h5 id="1-6-4-O-CREATä¸O-MKDIR"><a href="#1-6-4-O-CREATä¸O-MKDIR" class="headerlink" title="1.6.4 O_CREATä¸O_MKDIR"></a>1.6.4 O_CREATä¸O_MKDIR</h5><p>O_CREATä¸O_MKDIRæ˜¯å®éªŒä»£ç é‡Œå·²ç»å†…ç½®å¥½çš„ä¸¤ä¸ªå®å®šä¹‰ã€‚å¹¶ä¸”ä¿®æ”¹&#x2F;user&#x2F;serv.cé‡Œçš„serve_openå‡½æ•°ï¼Œä½¿å…¶åœ¨æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œè‹¥æ‰¾ä¸åˆ°è¯¥æ–‡ä»¶å°±åˆ›å»ºä¸€ä¸ªã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Open the file.</span></span><br><span class="line">    <span class="keyword">if</span> ((r = file_open(rq-&gt;req_path, &amp;f)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    	<span class="comment">//æ”¯æŒO_CREATå’ŒO_MKDIR</span></span><br><span class="line">        <span class="keyword">if</span> (r == -E_NOT_FOUND &amp;&amp; (rq-&gt;req_omode &amp; O_CREAT)) &#123;</span><br><span class="line">            r = file_create(rq-&gt;req_path, &amp;f); </span><br><span class="line">            f-&gt;f_type = FTYPE_REG;</span><br><span class="line">            <span class="keyword">if</span> (r &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            	ipc_send(envid, r, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r == -E_NOT_FOUND &amp;&amp; (rq-&gt;req_omode &amp; O_MKDIR)) &#123;</span><br><span class="line">            r = file_create(rq-&gt;req_path, &amp;f);</span><br><span class="line">            f-&gt;f_type = FTYPE_DIR;</span><br><span class="line">            <span class="keyword">if</span> (r &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            	ipc_send(envid, r, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ipc_send(envid, r, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="1-7-å®ç°å†å²å‘½ä»¤åŠŸèƒ½"><a href="#1-7-å®ç°å†å²å‘½ä»¤åŠŸèƒ½" class="headerlink" title="1.7 å®ç°å†å²å‘½ä»¤åŠŸèƒ½"></a>1.7 å®ç°å†å²å‘½ä»¤åŠŸèƒ½</h4><p>å†å²åŠŸèƒ½å®ç°æ€è·¯ï¼š</p>
<ul>
<li>é¦–å…ˆåˆ›å»ºä¸€ä¸ª.historyæ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªhis_pointerå˜é‡ï¼ŒæŒ‡å‘å½“å‰.historyé‡Œçš„é‚£æ¡æŒ‡ä»¤ã€‚<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">history_init</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    <span class="keyword">if</span> ((r = create(<span class="string">&quot;/.history&quot;</span>, FTYPE_REG)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        debugf(<span class="string">&quot;create .history fail\n&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        debugf(<span class="string">&quot;.history is created\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li>å½“è¯»å…¥ä¸€ä¸ªæ¢è¡Œç¬¦æ—¶ï¼Œæ‰“å¼€.historyï¼Œä¸ºäº†å®ç°æ¯æ¬¡éƒ½å°†å‘½ä»¤æ·»åŠ åˆ°æ–‡ä»¶çš„æœ«å°¾ï¼Œå¹¶ä¸”è°ƒç”¨seekå‡½æ•°ï¼Œå¯»æ‰¾åˆ°æ–‡ä»¶çš„æœ«å°¾ï¼Œå°†å½“å‰çš„æŒ‡ä»¤å†™å…¥.historyã€‚åŒæ—¶ä¹Ÿåœ¨fd.cä¸­å®ç°ä¸€ä¸ªget_sizeå‡½æ•°ï¼Œä¸ºäº†å¯»æ‰¾åˆ°æ–‡ä»¶çš„æœ«å°¾ã€‚<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***********è¯»å…¥å›è½¦é”®***********/</span></span><br><span class="line"><span class="keyword">if</span> (buf[i] == <span class="string">&#x27;\r&#x27;</span> || buf[i] == <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">    buf[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//å­˜è¿›å†å²è®°å½•é‡Œ</span></span><br><span class="line">    <span class="type">int</span> fd;</span><br><span class="line">    <span class="keyword">if</span> ((fd = open(<span class="string">&quot;/.history&quot;</span>, O_WRONLY)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;open .history fail!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    <span class="keyword">if</span> ((size = get_size(fd)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;get size fail!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((r = seek(fd, size))) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;seek fail!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((r = write(fd, cmd, <span class="built_in">strlen</span>(cmd))) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;write .history fail!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((r = write(fd, <span class="string">&quot;\n&quot;</span>, <span class="number">1</span>)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;write .history fail!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    close(fd);</span><br><span class="line">    his_num++;</span><br><span class="line">    his_pointer = his_num; <span class="comment">//æ¯æ¬¡è¯»å…¥å›è½¦éƒ½è®©æŒ‡é’ˆæŒ‡å‘æœ€åä¸€ä¸ª</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li>å½“è¯»å…¥ä¸Šä¸‹é”®æ—¶ï¼Œé¦–å…ˆè¿˜æ˜¯è¦æ§åˆ¶å…‰æ ‡çš„ç§»åŠ¨ï¼Œå…¶æ¬¡æ˜¯å°†.historyæ–‡ä»¶ä¸­æ‰€æœ‰çš„æŒ‡ä»¤å­˜è¿›ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œç„¶åè¯»å‡ºhis_pointerå¤„çš„æŒ‡ä»¤ï¼Œæœ€åå°†å½“å‰æ§åˆ¶å°çš„è¾“å‡ºæ¸…ç©ºï¼Œå°†è¿™æ¡å†å²æŒ‡ä»¤è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚ä¸‹å±•ç¤ºè¯»å…¥ä¸Šé”®æ—¶çš„ä»£ç ï¼Œè¯»å…¥ä¸‹é”®ä¸ä¹‹ç±»ä¼¼ã€‚<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//......</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (buf[i+<span class="number">2</span>] == <span class="number">65</span>) &#123; <span class="comment">//up</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c%c%c&quot;</span>, <span class="number">27</span>, <span class="number">91</span>, <span class="number">66</span>);</span><br><span class="line">    <span class="keyword">if</span> (his_pointer == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    his_pointer--;</span><br><span class="line">    <span class="type">char</span> tmp[<span class="number">128</span> * <span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> fd, count = <span class="number">0</span>, length = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ((fd =  open(<span class="string">&quot;/.history&quot;</span>, O_RDWR)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;open fail!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¿å­˜å½“å‰çš„æŒ‡ä»¤</span></span><br><span class="line">    cmd[pointer] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="comment">//è¯»å†å²æŒ‡ä»¤</span></span><br><span class="line">    <span class="keyword">if</span> ((r = read(fd, tmp, <span class="keyword">sizeof</span> tmp)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;read .history fail!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    close(fd);</span><br><span class="line">    <span class="comment">//å­˜è¿›äºŒç»´æ•°ç»„</span></span><br><span class="line">    <span class="type">char</span> records[<span class="number">100</span>][<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; tmp[j]; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tmp[j] != <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">            records[count][length++] = tmp[j];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            records[count][length] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            count++;</span><br><span class="line">            length = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcpy</span>(cmd, records[his_pointer]);</span><br><span class="line">    <span class="comment">//æ¸…é™¤å½“å‰æ§åˆ¶å°çš„è¾“å‡º</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; pointer; j++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\b \b&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    pointer = <span class="built_in">strlen</span>(cmd);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, cmd);</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li>æœ€åå®ç°history.cï¼Œå½“è¾“å…¥historyæŒ‡ä»¤æ—¶ï¼Œå°†.historyæ–‡ä»¶ä¸­éƒ½è¯»å‡ºæ¥ï¼Œç„¶åä¾æ¬¡è¾“å‡ºå³å¯ã€‚</li>
</ul>
<h3 id="é€‰åšéƒ¨åˆ†"><a href="#é€‰åšéƒ¨åˆ†" class="headerlink" title="é€‰åšéƒ¨åˆ†"></a>é€‰åšéƒ¨åˆ†</h3><p>é€‰åšéƒ¨åˆ†çš„ä¸¤ä¸ªåŠŸèƒ½éƒ½æœ‰å®ç°ï¼Œä¸‹é¢æŒ‰ç…§å®ç°é¡ºåºä¾æ¬¡ä»‹ç»ã€‚</p>
<h4 id="é€‰åšéƒ¨åˆ†-2ï¼šæ”¯æŒç›¸å¯¹è·¯å¾„"><a href="#é€‰åšéƒ¨åˆ†-2ï¼šæ”¯æŒç›¸å¯¹è·¯å¾„" class="headerlink" title="é€‰åšéƒ¨åˆ† 2ï¼šæ”¯æŒç›¸å¯¹è·¯å¾„"></a>é€‰åšéƒ¨åˆ† 2ï¼šæ”¯æŒç›¸å¯¹è·¯å¾„</h4><p>å®ç°æ€è·¯ï¼šåœ¨è¿›ç¨‹æ§åˆ¶å—ä¸­åŠ å…¥ä¸€ä¸ªå½“å‰è·¯å¾„çš„å±æ€§ï¼Œè¿ç”¨ç³»ç»Ÿè°ƒç”¨æ”¹å˜å½“å‰æ‰€å¤„è·¯å¾„å’Œå¾—åˆ°å½“å‰è·¯å¾„ï¼Œå¢åŠ ç³»ç»Ÿè°ƒç”¨çš„æµç¨‹åœ¨ä¸Šæœºçš„æ—¶å€™å·²ç»éå¸¸ç†Ÿç»ƒäº†ã€‚åœ¨forkä¸€ä¸ªæ–°è¿›ç¨‹æ—¶ï¼Œéœ€è¦è®©å­è¿›ç¨‹å¤åˆ¶çˆ¶è¿›ç¨‹çš„å½“å‰è·¯å¾„ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// include</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Env</span> &#123;</span></span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">    <span class="type">char</span> env_cur_path[<span class="number">1024</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// kern/syscall_all.c</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sys_change_dir</span><span class="params">(<span class="type">char</span> *path)</span> &#123;</span><br><span class="line">	<span class="built_in">strcpy</span>(curenv-&gt;env_cur_path, path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *<span class="title function_">sys_get_cur_path</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> curenv-&gt;env_cur_path;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä¹‹åæ˜¯å®ç°cdä¸pwdçš„åŠŸèƒ½ï¼Œè¿™é‡Œè¦æ³¨æ„cdã€pwdå‘½ä»¤æ˜¯å†…éƒ¨å‘½ä»¤ï¼Œä¸èƒ½åœ¨å¤–éƒ¨æ–‡ä»¶ä¸­å®ç°ï¼Œè¦åœ¨sh.cå†…éƒ¨å®ç°ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user/sh.c</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">chdir</span><span class="params">(<span class="type">char</span> *path)</span> &#123;</span><br><span class="line">    <span class="type">char</span> *new_path = parse_path(path);</span><br><span class="line">    <span class="type">int</span> fd;</span><br><span class="line">    <span class="keyword">if</span> ((fd = open(new_path, O_RDONLY)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;no such file or directory!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    syscall_change_dir(new_path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">getcwd</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">char</span> cur_path[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="built_in">strcpy</span>(cur_path, syscall_get_cur_path());</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, cur_path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//main</span></span><br><span class="line"><span class="comment">/*********** å†…éƒ¨å‘½ä»¤cd ***********/</span></span><br><span class="line"><span class="keyword">if</span> (cmd[<span class="number">0</span>] == <span class="string">&#x27;c&#x27;</span> &amp;&amp; cmd[<span class="number">1</span>] == <span class="string">&#x27;d&#x27;</span>) &#123;</span><br><span class="line">    <span class="type">char</span> path[MAXPATHLEN] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; cmd[i]; i++) &#123;</span><br><span class="line">        path[i] = cmd[i + <span class="number">3</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    path[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    chdir(path);</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*********** å†…éƒ¨å‘½ä»¤pwd ***********/</span></span><br><span class="line"><span class="keyword">if</span> (cmd[<span class="number">0</span>] == <span class="string">&#x27;p&#x27;</span> &amp;&amp; cmd[<span class="number">1</span>] == <span class="string">&#x27;w&#x27;</span> &amp;&amp; cmd[<span class="number">2</span>] == <span class="string">&#x27;d&#x27;</span>) &#123;</span><br><span class="line">    getcwd();</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>æœ€åæ˜¯è¦ä¿®æ”¹ä¹‹å‰æ‰€æœ‰çš„æŒ‡ä»¤ï¼Œä½¿ä¹‹æ”¯æŒç›¸å¯¹è·¯å¾„ã€‚ä¸ºäº†å¢å¼ºä»£ç çš„å¤ç”¨æ€§ï¼Œæˆ‘åœ¨user&#x2F;libä¸­æ–°å»ºäº†ä¸€ä¸ªpath.cæ–‡ä»¶ï¼Œå®ç°äº†å°†ç›¸å¯¹è·¯å¾„è½¬åŒ–ä¸ºç»å¯¹è·¯å¾„çš„åŠŸèƒ½ã€‚å…·ä½“å°†åœ¨ä¸‹æ–‡å®éªŒéš¾ç‚¹ä¸€èŠ‚ä¸­é‡ç‚¹ä»‹ç»ã€‚</p>
<h4 id="é€‰åšéƒ¨åˆ†1ï¼šå®ç°-shell-ç¯å¢ƒå˜é‡"><a href="#é€‰åšéƒ¨åˆ†1ï¼šå®ç°-shell-ç¯å¢ƒå˜é‡" class="headerlink" title="é€‰åšéƒ¨åˆ†1ï¼šå®ç° shell ç¯å¢ƒå˜é‡"></a>é€‰åšéƒ¨åˆ†1ï¼šå®ç° shell ç¯å¢ƒå˜é‡</h4><p>å®ç°æ€è·¯ï¼š</p>
<ul>
<li>åŒæ ·ä¹Ÿæ˜¯éœ€è¦åœ¨å†…æ ¸æ€æ›´æ”¹ï¼Œé¦–å…ˆä¸ºäº†è¯†åˆ«å‡ºçˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹ï¼Œéœ€è¦ç»™è¿›ç¨‹æ§åˆ¶å—ç¼–å·ï¼Œä¸º1åˆ™ä¸ºçˆ¶è¿›ç¨‹ï¼Œå¦åˆ™åˆ™ä¸ºå­è¿›ç¨‹ï¼Œç”¨ä»¥åŒºåˆ†å…¨å±€å˜é‡ä¸ç¯å¢ƒå˜é‡ã€‚<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// kern/syscall_all.c</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sys_set_shell_id</span><span class="params">()</span> &#123;</span><br><span class="line">	curenv-&gt;env_shell_id++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u_int <span class="title function_">sys_get_shell_id</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> curenv-&gt;env_shell_id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li>åœ¨å†…æ ¸æ€è®¾ç½®ä¸¤ä¸ªå…¨å±€äºŒç»´æ•°ç»„ï¼Œåˆ†åˆ«ä¸ºenv_key[128][128]å’Œenv_value[128][128]ï¼Œkeyå’Œvalueä¸€å®šæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œè¿˜æœ‰ä¸¤ä¸ªä¸€ç»´æ•°ç»„is_globalå’Œis_read_onlyç”¨ä»¥æ ‡è¯†ç¯å¢ƒå˜é‡æ˜¯å¦ä¸ºå…¨å±€å˜é‡å’Œæ˜¯å¦ä¸ºåªè¯»å˜é‡ã€‚å¹¶åœ¨å†…æ ¸æ€å®ç°å¯¹äºç¯å¢ƒå˜é‡çš„getä¸setæ–¹æ³•ã€‚å½“å‰shellçš„idä¸º1æ—¶å¯ä»¥è¯»å±€éƒ¨å˜é‡ï¼Œå¦åˆ™ä¸è¡Œã€‚æ­¤å¤–ï¼Œè¿˜éœ€åœ¨include&#x2F;error.hä¸­å®šä¹‰ä¸¤ç§é”™è¯¯ç±»å‹ã€‚<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> env_key[<span class="number">128</span>][<span class="number">128</span>];</span><br><span class="line"><span class="type">char</span> env_value[<span class="number">128</span>][<span class="number">128</span>];</span><br><span class="line"><span class="type">int</span> is_global[<span class="number">128</span>];</span><br><span class="line"><span class="type">int</span> is_read_only[<span class="number">128</span>];</span><br><span class="line"><span class="type">int</span> env_var_cnt;</span><br><span class="line"><span class="type">int</span> <span class="title function_">sys_get_env_var</span><span class="params">(<span class="type">char</span> *key, <span class="type">char</span> *value)</span> &#123;</span><br><span class="line">    <span class="type">int</span> global_perm = curenv-&gt;env_shell_id == <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; env_var_cnt; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(env_key[i], key) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!is_global[i]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (global_perm) &#123;</span><br><span class="line">                    <span class="built_in">strcpy</span>(value, env_value[i]);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> -E_BAD_ENV_VAR;</span><br><span class="line">            &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">strcpy</span>(value, env_value[i]);    </span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -E_ENV_VAR_NOT_FOUND;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">sys_set_env_var</span><span class="params">(<span class="type">char</span> *key, <span class="type">char</span> *value, <span class="type">int</span> global, <span class="type">int</span> read_only)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; env_var_cnt; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(key, env_key[i]) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_read_only[i]) &#123;</span><br><span class="line">                <span class="keyword">return</span> -E_BAD_ENV_VAR;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">strcpy</span>(env_value[i], value);</span><br><span class="line">            is_global[i] = global;</span><br><span class="line">            is_read_only[i] = read_only;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcpy</span>(env_key[env_var_cnt], key);</span><br><span class="line">    <span class="built_in">strcpy</span>(env_value[env_var_cnt], value);</span><br><span class="line">    is_global[env_var_cnt] = global;</span><br><span class="line">    is_read_only[env_var_cnt++] = read_only;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li>å®ç°declare.cï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­å…ˆè§£æå‚æ•°ï¼Œå°†å…¶æŒ‰ç…§â€œ&#x3D;â€ä¸¤ä¾§åˆ’åˆ†ï¼Œå†è¿›è¡Œç³»ç»Ÿè°ƒç”¨å­˜å‚¨è¯¥ç¯å¢ƒå˜é‡ã€‚<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user/declare.c</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">declare</span><span class="params">(<span class="type">char</span> *key, <span class="type">char</span> *value)</span> &#123;</span><br><span class="line">    <span class="type">int</span> read_only = flag[<span class="string">&#x27;r&#x27;</span>];</span><br><span class="line">    <span class="type">int</span> global = flag[<span class="string">&#x27;x&#x27;</span>];</span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    <span class="keyword">if</span> ((r = syscall_set_env_var(key, value, global, read_only)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;declare environment variable fail!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li>å®ç°declareå‘½ä»¤ï¼ŒåŒæ ·è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œæ‰“å°æ‰€æœ‰ç¯å¢ƒå˜é‡ã€‚<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sys_print_env_var</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; env_var_cnt; i++) &#123;</span><br><span class="line">        printk(<span class="string">&quot;%d: name: %s value: %s\n&quot;</span>, i, env_key[i], env_value[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li>å®ç°echo $nameåŠŸèƒ½ï¼Œå¯¹$è¿›è¡Œç‰¹åˆ¤ã€‚<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user/echo.c</span></span><br><span class="line"><span class="keyword">if</span> (argv[i][<span class="number">0</span>] == <span class="string">&#x27;$&#x27;</span>) &#123;</span><br><span class="line">    <span class="type">char</span> key[<span class="number">128</span>], value[<span class="number">128</span>];</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">1</span>; argv[i][j]; j++) &#123;</span><br><span class="line">        key[j<span class="number">-1</span>] = argv[i][j];</span><br><span class="line">    &#125;</span><br><span class="line">    key[j<span class="number">-1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> ((r = syscall_get_env_var(key, value)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;get environment variable fail!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, value);</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
</ul>
<h2 id="äºŒã€é¢å¤–å®ç°çš„åŠŸèƒ½"><a href="#äºŒã€é¢å¤–å®ç°çš„åŠŸèƒ½" class="headerlink" title="äºŒã€é¢å¤–å®ç°çš„åŠŸèƒ½"></a>äºŒã€é¢å¤–å®ç°çš„åŠŸèƒ½</h2><h4 id="2-1-strcat"><a href="#2-1-strcat" class="headerlink" title="2.1 strcat"></a>2.1 strcat</h4><p>strcatæ˜¯cè¯­è¨€æ ‡å‡†åº“ä¸­string.hçš„ä¸€ä¸ªé‡è¦å‡½æ•°ï¼Œä¹Ÿæ˜¯Lab6æŒ‘æˆ˜æ€§ä»»åŠ¡ä¸­æˆ‘ç”¨çš„æœ€å¤šçš„å‡½æ•°ã€‚ä½†æ˜¯æˆ‘ä»¬çš„string.hå±…ç„¶æ²¡æœ‰è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘åšçš„ç¬¬ä¸€é¡¹ä»»åŠ¡å°±æ˜¯æŠŠè¿™ä¸ªç©ºç¼ºç»™å¼¥è¡¥ä¸Šã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">strcat</span><span class="params">(<span class="type">char</span> *dest, <span class="type">const</span> <span class="type">char</span> *src)</span> &#123;</span><br><span class="line">    <span class="type">char</span> *tmp = dest;</span><br><span class="line">    <span class="keyword">while</span> (*dest)</span><br><span class="line">        dest++;</span><br><span class="line">        <span class="keyword">while</span> ((*dest++ = *src++) != <span class="string">&#x27;\0&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h4 id="2-2-rmæŒ‡ä»¤"><a href="#2-2-rmæŒ‡ä»¤" class="headerlink" title="2.2 rmæŒ‡ä»¤"></a>2.2 rmæŒ‡ä»¤</h4><p>rmæŒ‡ä»¤ä¹Ÿæ˜¯shellå‘½ä»¤ä¸­éå¸¸é‡è¦çš„æŒ‡ä»¤ï¼Œè€Œä¸”æˆ‘ä»¬çš„å®éªŒä»£ç ä¸­å·²ç»å®ç°äº†removeçš„ç”¨æˆ·æ¥å£ï¼Œåªéœ€è¦è°ƒç”¨ä¸€ä¸‹å¹¶ä¸”å®ç°ä¸€äº›å…³é”®çš„é€‰é¡¹å³å¯ã€‚æˆ‘ä¸€å…±å®ç°äº†ä¸‰ç§é€‰é¡¹ï¼šåˆ†åˆ«ä¸º-rã€-iå’Œ-fï¼Œåˆ†åˆ«ä¸ºé€’å½’åˆ é™¤ã€åˆ é™¤å‰è¯¢é—®ä»¥åŠå¼ºåˆ¶åˆ é™¤ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> flag[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">is_dir</span><span class="params">(<span class="type">int</span> fd)</span> &#123;</span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    <span class="keyword">if</span> ((r = get_type(fd)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;cannot find the file!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r == FTYPE_DIR;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">query</span><span class="params">(<span class="type">char</span> *path)</span> &#123;</span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    <span class="keyword">if</span> (flag[<span class="string">&#x27;i&#x27;</span>]) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;delete the file?: %s [y/n] &quot;</span>, path);</span><br><span class="line">        <span class="type">char</span> c;</span><br><span class="line">        <span class="keyword">if</span> ((r = read(<span class="number">0</span>, &amp;c, <span class="number">1</span>)) != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                debugf(<span class="string">&quot;read error: %d\n&quot;</span>, r);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (c != <span class="string">&#x27;y&#x27;</span> &amp;&amp; c != <span class="string">&#x27;Y&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">rm</span><span class="params">(<span class="type">char</span> *path)</span> &#123;</span><br><span class="line">    <span class="type">int</span> r, fd, n;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">File</span> <span class="title">f</span>;</span></span><br><span class="line">    <span class="keyword">if</span> ((fd = open(path, O_RDONLY)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;no such file or directory!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((r = get_type(fd)) == FTYPE_DIR) &#123;</span><br><span class="line">        <span class="keyword">if</span> (flag[<span class="string">&#x27;r&#x27;</span>]) &#123;</span><br><span class="line">            <span class="keyword">while</span> ((n = readn(fd, &amp;f, <span class="keyword">sizeof</span> f)) == <span class="keyword">sizeof</span> f) &#123;</span><br><span class="line">                <span class="type">char</span> new_path[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">                <span class="built_in">strcpy</span>(new_path, path);</span><br><span class="line">                <span class="keyword">if</span> (f.f_name[<span class="number">0</span>]) &#123;</span><br><span class="line">                    <span class="built_in">strcat</span>(new_path, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">                    <span class="built_in">strcat</span>(new_path, f.f_name);</span><br><span class="line">                    <span class="keyword">if</span> (f.f_type == FTYPE_REG) &#123;</span><br><span class="line">                        query(new_path);</span><br><span class="line">                        remove(new_path);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        rm(new_path);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            query(path);</span><br><span class="line">            remove(path);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            user_panic(<span class="string">&quot;cannot remove: it is a directory&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        query(path);</span><br><span class="line">        remove(path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">usage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;usage: rm [-é€‰é¡¹] [file...]\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line">	ARGBEGIN &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;i&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;f&#x27;</span>:</span><br><span class="line">        flag[(u_char)ARGC()]++;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        usage();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ARGEND</span><br><span class="line">    <span class="title function_">for</span> <span class="params">(<span class="type">int</span> i = <span class="number">0</span>; i &lt; argc; i++)</span> &#123;</span><br><span class="line">        <span class="type">char</span> *path = parse_path(argv[i]);</span><br><span class="line">        rm(path);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h4 id="2-3"><a href="#2-3" class="headerlink" title="2.3 &gt;&gt;"></a>2.3 &gt;&gt;</h4><p>æˆ‘ä»¬çš„mosç›®å‰å¯ä»¥æ”¯æŒé‡å®šå‘ï¼Œä½†è¿˜ä¸èƒ½æ”¯æŒè¿½åŠ é‡å®šå‘ã€‚&gt;&gt; çš„å®ç°æ•´ä½“ä¸Šå¯å‚è€ƒ&gt; çš„å®ç°ï¼ŒåŒæ ·ä¹Ÿæ˜¯éœ€è¦ç”¨åˆ°seekæ¥é”å®šæ–‡ä»¶æœ«å°¾ï¼ŒéšåæŠŠæ ‡å‡†è¾“å‡ºå¤åˆ¶åˆ°ç›®æ ‡æ–‡ä»¶é‡Œï¼Œå¹¶ä¸”ä¹Ÿæ˜¯æ”¯æŒå½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶å°±æ–°å»ºä¸€ä¸ªã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user/sh.c</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;&gt;&gt;&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> (gettoken(<span class="number">0</span>, &amp;t) != <span class="string">&#x27;w&#x27;</span>) &#123;</span><br><span class="line">        debugf(<span class="string">&quot;syntax error: &gt;&gt; not followed by word\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((fd = open(t, O_WRONLY | O_CREAT)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;open fail!&quot;</span>);</span><br><span class="line">    &#125;      </span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    <span class="keyword">if</span> ((size = get_size(fd)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;get size fail!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((r = seek(fd, size))) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;seek fail!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((r = dup(fd, <span class="number">1</span>)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;dup fail!&quot;</span>);</span><br><span class="line">    &#125;       </span><br><span class="line">    <span class="keyword">if</span> ((r = close(fd)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;close fail!&quot;</span>);</span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure></div>
<h4 id="2-4-å®ç°è‡ªåŠ¨è¡¥å…¨"><a href="#2-4-å®ç°è‡ªåŠ¨è¡¥å…¨" class="headerlink" title="2.4 å®ç°è‡ªåŠ¨è¡¥å…¨"></a>2.4 å®ç°è‡ªåŠ¨è¡¥å…¨</h4><p>å®ç°æ€è·¯ï¼šå½“è¯»å…¥åˆ°tabé”®æ—¶ï¼Œæ¯”è¾ƒå½“å‰è¿™æ®µå­—ç¬¦ä¸²æ˜¯å¦æ˜¯å½“å‰æ‰€æœ‰æ”¯æŒçš„å‘½ä»¤çš„å‰ç¼€ï¼Œå†æ¯”è¾ƒè¯¥å­—ç¬¦ä¸²æ˜¯å¦æ˜¯å½“å‰ç›®å½•ä¸‹æ–‡ä»¶çš„å‰ç¼€ã€‚å½“æ‰¾åˆ°å”¯ä¸€ä¸€ä¸ªå¯è¡¥å…¨çš„å­—ç¬¦ä¸²æ—¶å¯ä»¥è¡¥å…¨ï¼Œå…¶ä½™æƒ…å†µä¸åšå¤„ç†ã€‚</p>
<h4 id="2-5-å®ç°cpæŒ‡ä»¤"><a href="#2-5-å®ç°cpæŒ‡ä»¤" class="headerlink" title="2.5 å®ç°cpæŒ‡ä»¤"></a>2.5 å®ç°cpæŒ‡ä»¤</h4><p>å®ç°æ€è·¯ï¼šä¸rmç±»ä¼¼ï¼Œåˆ†ä¸º-rã€-ié€‰é¡¹ï¼Œåˆ†åˆ«ä¸ºé€’å½’å¤åˆ¶ï¼Œè¦†ç›–å‰è¯¢é—®ã€‚å¤åˆ¶çš„æœ¬è´¨æ˜¯å°†æ¥æºæ–‡ä»¶çš„å†…å®¹è¯»å‡ºï¼Œå¹¶å†™å…¥ç›®æ ‡æ–‡ä»¶ã€‚æ³¨æ„èµ‹å€¼æ—¶ä»æ¥æºæ–‡ä»¶è¯»çš„å­—ç¬¦æ•°ç»„ä¸ç›®æ ‡æ–‡ä»¶å†™çš„å­—ç¬¦æ•°ç»„ä¸èƒ½æ˜¯åŒä¸€ä¸ªï¼Œå¦åˆ™åªèƒ½è¾¾æˆâ€œæµ…æ‹·è´â€çš„æ•ˆæœã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user/cp.c</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">copy</span><span class="params">(<span class="type">int</span> srcfd, <span class="type">int</span> dstfd)</span> &#123;</span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    <span class="type">char</span> text[<span class="number">128</span> * <span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">char</span> new_text[<span class="number">128</span> * <span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> ((r = read(srcfd, text, <span class="keyword">sizeof</span> text)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;cannot read the file&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcpy</span>(new_text, text);</span><br><span class="line">    <span class="keyword">if</span> ((r = write(dstfd, new_text, <span class="keyword">sizeof</span> text)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        user_panic(<span class="string">&quot;cannot write the file&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="ä¸‰ã€å®éªŒç»“æœ"><a href="#ä¸‰ã€å®éªŒç»“æœ" class="headerlink" title="ä¸‰ã€å®éªŒç»“æœ"></a>ä¸‰ã€å®éªŒç»“æœ</h2><h4 id="3-1-å®ç°ä¸€è¡Œå¤šå‘½ä»¤-å®ç°å¼•å·æ”¯æŒ-å®ç°ç¨‹åºåç§°ä¸­-b-çš„çœç•¥"><a href="#3-1-å®ç°ä¸€è¡Œå¤šå‘½ä»¤-å®ç°å¼•å·æ”¯æŒ-å®ç°ç¨‹åºåç§°ä¸­-b-çš„çœç•¥" class="headerlink" title="3.1 å®ç°ä¸€è¡Œå¤šå‘½ä»¤ + å®ç°å¼•å·æ”¯æŒ + å®ç°ç¨‹åºåç§°ä¸­ .b çš„çœç•¥"></a>3.1 å®ç°ä¸€è¡Œå¤šå‘½ä»¤ + å®ç°å¼•å·æ”¯æŒ + å®ç°ç¨‹åºåç§°ä¸­ .b çš„çœç•¥</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/1.png"
                      alt="1"
                ></p>
<h4 id="3-2-å®ç°åå°ä»»åŠ¡"><a href="#3-2-å®ç°åå°ä»»åŠ¡" class="headerlink" title="3.2 å®ç°åå°ä»»åŠ¡"></a>3.2 å®ç°åå°ä»»åŠ¡</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/12.png"
                      alt="12"
                ></p>
<h4 id="3-3-å®ç°é”®å…¥å‘½ä»¤æ—¶ä»»æ„ä½ç½®çš„ä¿®æ”¹"><a href="#3-3-å®ç°é”®å…¥å‘½ä»¤æ—¶ä»»æ„ä½ç½®çš„ä¿®æ”¹" class="headerlink" title="3.3 å®ç°é”®å…¥å‘½ä»¤æ—¶ä»»æ„ä½ç½®çš„ä¿®æ”¹"></a>3.3 å®ç°é”®å…¥å‘½ä»¤æ—¶ä»»æ„ä½ç½®çš„ä¿®æ”¹</h4><p>è¯¥ä»»åŠ¡é€‚å®œå®æ—¶å±•ç°æ•ˆæœï¼Œéš¾ä»¥é€šè¿‡å›¾ç‰‡å½¢å¼çœ‹å‡ºæ•ˆæœ</p>
<h4 id="3-4-å®ç°æ›´å¤šå‘½ä»¤ï¼ˆtree-mkdir-touchï¼‰"><a href="#3-4-å®ç°æ›´å¤šå‘½ä»¤ï¼ˆtree-mkdir-touchï¼‰" class="headerlink" title="3.4 å®ç°æ›´å¤šå‘½ä»¤ï¼ˆtree mkdir touchï¼‰"></a>3.4 å®ç°æ›´å¤šå‘½ä»¤ï¼ˆtree mkdir touchï¼‰</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/2.png"
                      alt="2"
                ></p>
<h4 id="3-5-å®ç°å†å²å‘½ä»¤åŠŸèƒ½"><a href="#3-5-å®ç°å†å²å‘½ä»¤åŠŸèƒ½" class="headerlink" title="3.5 å®ç°å†å²å‘½ä»¤åŠŸèƒ½"></a>3.5 å®ç°å†å²å‘½ä»¤åŠŸèƒ½</h4><p>ä¸Šä¸‹é”®çš„åŠŸèƒ½ä¸ä¾¿ä»¥å›¾ç‰‡å½¢å¼å±•ç¤ºï¼Œæ­¤å¤„åªå±•ç°historyæŒ‡ä»¤<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/3.png"
                      alt="3"
                ></p>
<h4 id="3-6-æ”¯æŒç›¸å¯¹è·¯å¾„"><a href="#3-6-æ”¯æŒç›¸å¯¹è·¯å¾„" class="headerlink" title="3.6 æ”¯æŒç›¸å¯¹è·¯å¾„"></a>3.6 æ”¯æŒç›¸å¯¹è·¯å¾„</h4><p>ä¸ºäº†æ›´è´´è¿‘linuxï¼Œæˆ‘å°†æŒ‡ä»¤å·¦ä¾§æ”¹ä¸ºäº†å­¦å·+ç›¸å¯¹è·¯å¾„çš„å½¢å¼ï¼Œä¸è·³æ¿æœºçš„æ ¼å¼ç›¸åŒã€‚<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/4.png"
                      alt="4"
                ></p>
<h4 id="3-7-å®ç°-shell-ç¯å¢ƒå˜é‡"><a href="#3-7-å®ç°-shell-ç¯å¢ƒå˜é‡" class="headerlink" title="3.7 å®ç° shell ç¯å¢ƒå˜é‡"></a>3.7 å®ç° shell ç¯å¢ƒå˜é‡</h4><p>ä¾æ¬¡å…ˆåæµ‹è¯•äº†ï¼šä¸åŒç±»å‹ç¯å¢ƒå˜é‡çš„åˆ›å»ºã€åˆ é™¤éåªè¯»å˜é‡ã€åˆ é™¤åªè¯»å˜é‡ã€ä¿®æ”¹åªè¯»å˜é‡ã€ä¿®æ”¹éåªè¯»å˜é‡ã€å¯åŠ¨å­shellåèƒ½å¦è¯»å–å±€éƒ¨å˜é‡ã€‚<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/5.png"
                      alt="5"
                ></p>
<h4 id="3-8-å®ç°rm"><a href="#3-8-å®ç°rm" class="headerlink" title="3.8 å®ç°rm"></a>3.8 å®ç°rm</h4><ul>
<li>åˆ é™¤æ™®é€šæ–‡ä»¶<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/9.png"
                      alt="9"
                ></li>
<li>é€’å½’åˆ é™¤ç›®å½•<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/10.jpeg"
                      alt="10"
                ></li>
<li>åˆ é™¤å‰è¯¢é—®<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/8.png"
                      alt="8"
                ></li>
</ul>
<h3 id="3-9-å®ç°"><a href="#3-9-å®ç°" class="headerlink" title="3.9 å®ç°&gt;&gt;"></a>3.9 å®ç°&gt;&gt;</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/goldenkm/Pic-Bed@main/os-lab6-challenge/11.png"
                      alt="11"
                ></p>
<h2 id="å››ã€å®éªŒéš¾ç‚¹åŠè§£å†³æ–¹æ¡ˆ"><a href="#å››ã€å®éªŒéš¾ç‚¹åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="å››ã€å®éªŒéš¾ç‚¹åŠè§£å†³æ–¹æ¡ˆ"></a>å››ã€å®éªŒéš¾ç‚¹åŠè§£å†³æ–¹æ¡ˆ</h2><h4 id="4-1-æ§åˆ¶å°è¾“å…¥éƒ¨åˆ†ä¸ç¨‹åºå®é™…æ¥æ”¶åˆ°çš„æŒ‡ä»¤çš„ååŒ"><a href="#4-1-æ§åˆ¶å°è¾“å…¥éƒ¨åˆ†ä¸ç¨‹åºå®é™…æ¥æ”¶åˆ°çš„æŒ‡ä»¤çš„ååŒ" class="headerlink" title="4.1 æ§åˆ¶å°è¾“å…¥éƒ¨åˆ†ä¸ç¨‹åºå®é™…æ¥æ”¶åˆ°çš„æŒ‡ä»¤çš„ååŒ"></a>4.1 æ§åˆ¶å°è¾“å…¥éƒ¨åˆ†ä¸ç¨‹åºå®é™…æ¥æ”¶åˆ°çš„æŒ‡ä»¤çš„ååŒ</h4><p>&emsp;&emsp;åœ¨user&#x2F;sh.cçš„readlineå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬çš„ä»£ç ç”¨çš„æ˜¯ä¸€ä¸ªåä¸ºbufçš„å­—ç¬¦æ•°ç»„è¯»å–çš„è¾“å…¥ã€‚è€Œå¦‚æœæ²¡æœ‰å¼•å…¥ç§»åŠ¨å…‰æ ‡çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å‘runcmdä¸­ä¼ å…¥è¿™ä¸€æ•°ç»„è¿›è¡Œè§£æã€‚ä½†ç°åœ¨å¼•å…¥äº†å…‰æ ‡çš„ç§»åŠ¨ï¼Œbufä¼šè¯»å…¥æ–¹å‘é”®çš„asciiç ï¼Œå¹¶ä¸”æ‰€æœ‰å­—ç¬¦ä¹Ÿéƒ½æ˜¯é¡ºåºè¯»å…¥çš„ï¼Œæ˜¾ç„¶æ˜¯æ— æ³•ç›´æ¥è§£æçš„ã€‚æ‰€ä»¥æˆ‘é€‰æ‹©äº†å°†è¿™ä¸ªbufä»…ä½œä¸ºè¯»å…¥å­—ç¬¦ä½¿ç”¨ï¼Œå®é™…çš„æŒ‡ä»¤éƒ¨åˆ†æ–°å»ºä¸€ä¸ªåä¸ºcmdçš„å­—ç¬¦æ•°ç»„ï¼Œæ‰€æœ‰æ›´æ”¹éƒ½å¯¹cmdè¿›è¡Œæ›´æ”¹ã€‚</p>
<h4 id="4-2-å¦‚ä½•æŒæ¡å…‰æ ‡çš„ä½ç½®"><a href="#4-2-å¦‚ä½•æŒæ¡å…‰æ ‡çš„ä½ç½®" class="headerlink" title="4.2 å¦‚ä½•æŒæ¡å…‰æ ‡çš„ä½ç½®"></a>4.2 å¦‚ä½•æŒæ¡å…‰æ ‡çš„ä½ç½®</h4><p>&emsp;&emsp;äº‹å®ä¸Šï¼Œæˆ‘ä»¬å§‹ç»ˆéƒ½éœ€è¦ä¿è¯æ§åˆ¶å°è¾“å…¥ã€ç¨‹åºæ¥æ”¶åˆ°çš„æŒ‡ä»¤ä¸æ§åˆ¶å°è¾“å‡ºä¸‰è€…ä¿æŒå®Œå…¨ä¸€è‡´ï¼Œè€Œåä¸¤è€…çš„ä¸€è‡´æ€§å¯ä»¥é è¿ç»­è¾“å‡ºä¸‰ä¸ªå­—ç¬¦æ¥å®Œæˆï¼Œå¦‚è¾“å‡ºä¸€ä¸ªä¸‹é”®å¯ä»¥é€šè¿‡<code>printf(&quot;%c%c%c&quot;, 27, 91, 66)</code>è¿™æ¡è¯­å¥æ¥å®ç°ã€‚ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡asciiç æ¥å®ç°æ§åˆ¶å°ä¸­å…‰æ ‡çš„éšæ„ç§»åŠ¨ã€‚</p>
<h4 id="4-3-ä¿®æ”¹fd-cï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ›´æ–¹ä¾¿çš„å¾—çŸ¥æ–‡ä»¶çš„ä¸€äº›åŸºæœ¬å±æ€§ã€‚"><a href="#4-3-ä¿®æ”¹fd-cï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ›´æ–¹ä¾¿çš„å¾—çŸ¥æ–‡ä»¶çš„ä¸€äº›åŸºæœ¬å±æ€§ã€‚" class="headerlink" title="4.3 ä¿®æ”¹fd.cï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ›´æ–¹ä¾¿çš„å¾—çŸ¥æ–‡ä»¶çš„ä¸€äº›åŸºæœ¬å±æ€§ã€‚"></a>4.3 ä¿®æ”¹fd.cï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ›´æ–¹ä¾¿çš„å¾—çŸ¥æ–‡ä»¶çš„ä¸€äº›åŸºæœ¬å±æ€§ã€‚</h4><p>&emsp;&emsp;åœ¨å®ç°æŒ‡ä»¤çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¾—çŸ¥æ–‡ä»¶çš„ä¸€äº›åŸºæœ¬å±æ€§ï¼Œå¦‚æ–‡ä»¶çš„åå­—ã€å¤§å°ã€ç§ç±»ç­‰ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åƒé¢å‘å¯¹è±¡ä¸€æ ·ï¼Œä¸ºæ–‡ä»¶å†™ä¸€äº›getæ–¹æ³•ï¼Œæˆ‘æ˜¯åœ¨fd.cå®ç°çš„ï¼Œå¯ä»¥é€šè¿‡fdnumå°±è·å¾—æ–‡ä»¶çš„å¤§å°ã€ç§ç±»ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user/lib/fd.c</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">get_size</span><span class="params">(<span class="type">int</span> fdnum)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Fd</span> *<span class="title">fd</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Filefd</span> *<span class="title">ffd</span>;</span></span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    <span class="keyword">if</span> ((r = fd_lookup(fdnum, &amp;fd)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    	<span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    ffd = (<span class="keyword">struct</span> Filefd *)fd;</span><br><span class="line">    <span class="type">int</span> size = ffd-&gt;f_file.f_size;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">get_type</span><span class="params">(<span class="type">int</span> fdnum)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Fd</span> *<span class="title">fd</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Filefd</span> *<span class="title">ffd</span>;</span></span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    <span class="keyword">if</span> ((r = fd_lookup(fdnum, &amp;fd)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    	<span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    ffd = (<span class="keyword">struct</span> FileFd *)fd;</span><br><span class="line">    <span class="type">int</span> type = ffd-&gt;f_file.f_type;</span><br><span class="line">    <span class="keyword">return</span> type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h4 id="4-4-è®©æ‰€æœ‰æŒ‡ä»¤éƒ½æ”¯æŒç›¸å¯¹è·¯å¾„ï¼ˆ"><a href="#4-4-è®©æ‰€æœ‰æŒ‡ä»¤éƒ½æ”¯æŒç›¸å¯¹è·¯å¾„ï¼ˆ" class="headerlink" title="4.4 è®©æ‰€æœ‰æŒ‡ä»¤éƒ½æ”¯æŒç›¸å¯¹è·¯å¾„ï¼ˆ.&#x2F;..)"></a>4.4 è®©æ‰€æœ‰æŒ‡ä»¤éƒ½æ”¯æŒç›¸å¯¹è·¯å¾„ï¼ˆ.&#x2F;..)</h4><p>ä¸ºäº†å‘çœŸå®çš„linuxé æ‹¢ï¼Œæˆ‘è¿˜å®ç°äº†..ï¼ˆä¸Šçº§ç›®å½•ï¼‰ä¸.ï¼ˆå½“å‰ç›®å½•ï¼‰ï¼Œä¸ºäº†åœ¨æ‰€æœ‰æ–‡ä»¶ä¸­éƒ½èƒ½å®ç°ç›¸å¯¹è·¯å¾„ï¼Œæˆ‘åœ¨user&#x2F;libé‡Œæ–°å»ºäº†ä¸€ä¸ªpath.cæ–‡ä»¶ç”¨äºè§£æè·¯å¾„ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">parse_path</span><span class="params">(<span class="type">char</span> *path)</span> &#123;</span><br><span class="line">    <span class="type">char</span> cur_path[MAXPATHLEN] = &#123;<span class="number">0</span>&#125;; </span><br><span class="line">    <span class="type">char</span> tmp_path[MAXPATHLEN] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">char</span> new_path[MAXPATHLEN] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">strcpy</span>(cur_path, syscall_get_cur_path());</span><br><span class="line">    <span class="keyword">if</span> (path[<span class="number">0</span>] != <span class="string">&#x27;/&#x27;</span>) &#123;	<span class="comment">//ä¼ è¿›æ¥çš„æ˜¯ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">    	<span class="keyword">if</span> (cur_path[<span class="built_in">strlen</span>(cur_path) - <span class="number">1</span>] != <span class="string">&#x27;/&#x27;</span>) &#123;s</span><br><span class="line">    	    <span class="title function_">strcpy</span><span class="params">(tmp_path, cur_path)</span>;</span><br><span class="line">    	    <span class="built_in">strcat</span>(tmp_path, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">    	    <span class="built_in">strcat</span>(tmp_path, path);</span><br><span class="line">    	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    	    <span class="built_in">strcpy</span>(tmp_path, cur_path);</span><br><span class="line">    	    <span class="built_in">strcat</span>(tmp_path, path);</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    	<span class="built_in">strcpy</span>(tmp_path, path);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">char</span> files[<span class="number">128</span>][<span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">char</span> new_files[<span class="number">128</span>][<span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">char</span> tmp_file[<span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> p = <span class="number">0</span>;	<span class="comment">//æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">int</span> length = <span class="number">0</span>, file_cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> tmp_path_len = <span class="built_in">strlen</span>(tmp_path);</span><br><span class="line">    <span class="keyword">if</span> (tmp_path[tmp_path_len - <span class="number">1</span>] != <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">    	tmp_path[tmp_path_len] = <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    	tmp_path[tmp_path_len + <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; tmp_path[i]; i++) &#123;</span><br><span class="line">    	<span class="keyword">if</span> (tmp_path[i] != <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">    	    tmp_file[length++] = tmp_path[i];</span><br><span class="line">    	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    	    tmp_file[length] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    	    <span class="built_in">strcpy</span>(files[file_cnt++], tmp_file);</span><br><span class="line">    	    <span class="built_in">memset</span>(tmp_file, <span class="number">0</span>, <span class="keyword">sizeof</span>(tmp_file));</span><br><span class="line">    	    length = <span class="number">0</span>;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; file_cnt; i++) &#123;</span><br><span class="line">    	<span class="keyword">if</span> (<span class="built_in">strcmp</span>(files[i], <span class="string">&quot;..&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    	    p--;</span><br><span class="line">    	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(files[i], <span class="string">&quot;.&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    	    <span class="keyword">continue</span>;</span><br><span class="line">    	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    	    <span class="built_in">memset</span>(new_files[p], <span class="number">0</span>, <span class="keyword">sizeof</span>(new_files[p]));</span><br><span class="line">    	    <span class="built_in">strcpy</span>(new_files[p++], files[i]);</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    new_path[<span class="number">0</span>] = <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; p; i++) &#123;</span><br><span class="line">    	<span class="built_in">strcat</span>(new_path, new_files[i]);</span><br><span class="line">    	<span class="keyword">if</span> (i != p - <span class="number">1</span>) &#123;</span><br><span class="line">    	    <span class="built_in">strcat</span>(new_path, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">char</span> *pointer = new_path;</span><br><span class="line">    <span class="keyword">return</span> pointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="äº”ã€å®éªŒä½“ä¼š"><a href="#äº”ã€å®éªŒä½“ä¼š" class="headerlink" title="äº”ã€å®éªŒä½“ä¼š"></a>äº”ã€å®éªŒä½“ä¼š</h2><p>&emsp;&emsp;æŒ‘æˆ˜æ€§ä»»åŠ¡çš„å®éªŒéš¾åº¦æ— ç–‘æ˜¯æ¯”ä»»ä½•ä¸€ä¸ªLabçš„éš¾åº¦éƒ½è¦é«˜çš„ï¼Œå®ƒè€ƒéªŒçš„æ˜¯ä½ å¯¹äºè¿™äº›ä»£ç ç»¼åˆè¿ç”¨çš„èƒ½åŠ›ï¼Œæ¯”ä¹‹å‰çš„å®Œå½¢å¡«ç©ºé«˜åˆ°ä¸çŸ¥å“ªé‡Œå»äº†ã€‚æˆ‘åœ¨Lab6æŒ‘æˆ˜æ€§ä»»åŠ¡ä¹Ÿæ˜¯æ·±æœ‰ä½“ä¼šï¼Œæ­¤å‰å·æ‡’æ²¡çœ‹çš„ä»£ç åœ¨æŒ‘æˆ˜æ€§ä»»åŠ¡é‡Œéƒ½ä¼šä¸€ä¸€å¿è¿˜çš„ã€‚è¯šç„¶æŒ‘æˆ˜æ€§ä»»åŠ¡çš„ç¡®å¾ˆéš¾ï¼Œä½†ä¸€ç‚¹ä¸€ç‚¹å»å®Œæˆå®ç°çš„è¿‡ç¨‹ä¹Ÿæ˜¯éå¸¸å¿«ä¹å¹¶ä¸”å¯Œæœ‰æ»¡è¶³æ„Ÿã€‚å°¤å…¶æ˜¯å½“ä½ é€‰äº†Lab6è¿™æ ·æ•ˆæœéå¸¸ç›´è§‚çš„æŒ‘æˆ˜æ€§ä»»åŠ¡ï¼Œçœ‹åˆ°å±äºè‡ªå·±çš„mosä¸æ–­å®Œå–„ï¼Œå¹¶é€æ¸å¼ºå¤§ï¼Œå°±è§‰å¾—æ‰€æœ‰çš„åŠªåŠ›éƒ½æ˜¯å€¼å¾—çš„ã€‚<br>&emsp;&emsp;å›é¡¾ä¸€å­¦æœŸæ“ä½œç³»ç»Ÿçš„å­¦ä¹ ï¼Œæˆ‘æƒ³å¯¹æˆ‘æå‡æœ€å¤§çš„é™¤äº†å¯¹äºæ“ä½œç³»ç»Ÿçš„ç†è§£ï¼Œå°±æ˜¯å¯¹äºcè¯­è¨€çš„æŒæ¡ç¨‹åº¦äº†ã€‚å­¦ä¹ è¿‡æ“ä½œç³»ç»Ÿä»¥åæˆ‘å¯¹cè¯­è¨€çš„äº†è§£ç¨‹åº¦å¯ä»¥è¯´æ˜¯æ¯”å¤§ä¸€ä¸Šå®Œç¨‹è®¾ã€æ•°æ®ç»“æ„åˆæ›´ä¸Šä¸€å±‚æ¥¼ã€‚åœ¨å®ŒæˆLab6çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å’Œä¼™ä¼´æ›¾ç»ä»…ä»…å¯¹äºæŒ‡é’ˆçš„ä¸€ä¸ªå°é—®é¢˜å°±æ¢è®¨äº†ä¸¤ä¸ªå°æ—¶ï¼Œå¹¶ä¸”è¿˜å†™äº†å¾ˆå¤šçš„æµ‹è¯•å°ç¨‹åºç”¨æ¥æ¢ç©¶åŸç†ã€‚æˆ‘æƒ³è¿™äº›æ–¹é¢å¯¹æˆ‘çš„æå‡æ˜¯æœ€å…³é”®çš„ï¼Œæˆ–è®¸è‹¥å¹²å¹´åæˆ‘ä¼šå¿˜è®°æ“ä½œç³»ç»Ÿçš„çŸ¥è¯†ã€ä¼šå¿˜è®°cè¯­è¨€çš„æœºåˆ¶ï¼Œä½†æ˜¯é‡åˆ°é—®é¢˜å»å†™ä¸€ä¸ªæµ‹è¯•ç¨‹åºéªŒè¯çš„è¿™ç§ç²¾ç¥ä¸æ–¹æ³•æ˜¯å¯ä»¥ä¼´éšæˆ‘å¾ˆé•¿æ—¶é—´çš„ã€‚è¿™å°±æ˜¯è¿™é—¨è¯¾å¸¦ç»™æˆ‘çš„æœ€å¤§çš„æå‡ã€‚</p>

        </div>

        
            <div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>æ ‡é¢˜:</strong> OS-Lab6-æŒ‘æˆ˜æ€§ä»»åŠ¡ å®éªŒæŠ¥å‘Š</li>
        <li><strong>ä½œè€…:</strong> jkm</li>
        <li><strong>åˆ›å»ºäº
                :</strong> 2024-08-18 00:41:00</li>
        
            <li>
                <strong>æ›´æ–°äº
                    :</strong> 2024-08-24 22:49:25
            </li>
        
        <li>
            <strong>é“¾æ¥:</strong> https://goldenkm.github.io/2024/08/18/OS-Lab6-Challenge-Experiment-Report/
        </li>
        <li>
            <strong>
                ç‰ˆæƒå£°æ˜:
            </strong>
            

            
                æœ¬æ–‡ç« é‡‡ç”¨ <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> è¿›è¡Œè®¸å¯ã€‚
            
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/C/">#C</a>&nbsp;
                    </li>
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/OS/">#OS</a>&nbsp;
                    </li>
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/">#å®éªŒæŠ¥å‘Š</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2024/08/18/Compiler-Doc/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Compiler-ç¼–è¯‘è®¾è®¡æ–‡æ¡£</span>
                                <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2024/08/18/OS-Lab6-Experiment-Report/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">OS-Lab6 å®éªŒæŠ¥å‘Š</span>
                                <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
            <div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
                <div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        è¯„è®º
    </div>
    

        
            
    <div id="gitalk-container"></div>
    <script data-swup-reload-script
            src="//cdn.staticfile.org/gitalk/1.8.0/gitalk.min.js"></script>
    <script data-swup-reload-script>

        function loadGitalk() {
            let __gitalk__pathname = decodeURI(location.pathname);
            const __gitalk__pathnameLength = __gitalk__pathname.length;
            const __gitalk__pathnameMaxLength = 50;
            if (__gitalk__pathnameLength > __gitalk__pathnameMaxLength) {
                __gitalk__pathname = __gitalk__pathname.substring(0, __gitalk__pathnameMaxLength - 3) + '...';
            }

            try {
                Gitalk && new Gitalk({
                    clientID: 'Ov23liEcTDl0trR9iKew',
                    clientSecret: '6f66e549afdfbbb62b4cb872074526f054d94d67',
                    repo: 'Blog-Comment',
                    owner: 'goldenkm',
                    admin: ['goldenkm'],
                    id: __gitalk__pathname,
                    language: 'zh-CN',
                    proxy: 'https://github.com/login/oauth/access_token'
                }).render('gitalk-container');

            } catch (e) {
                window.Gitalk = null;
            }
        }

        if ('true') {
            const loadGitalkTimeout = setTimeout(() => {
                loadGitalk();
                clearTimeout(loadGitalkTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadGitalk);
        }
    </script>



        
    
</div>

            </div>
        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">æ­¤é¡µç›®å½•</div>
        <div class="page-title">OS-Lab6-æŒ‘æˆ˜æ€§ä»»åŠ¡ å®éªŒæŠ¥å‘Š</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Lab6%E6%8C%91%E6%88%98%E6%80%A7%E4%BB%BB%E5%8A%A1%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A"><span class="nav-text">Lab6æŒ‘æˆ˜æ€§ä»»åŠ¡å®éªŒæŠ¥å‘Š</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%90%84%E9%A1%B9%E4%BB%BB%E5%8A%A1%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="nav-text">ä¸€ã€å„é¡¹ä»»åŠ¡å®ç°æ€è·¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%85%E5%81%9A%E9%83%A8%E5%88%86"><span class="nav-text">å¿…åšéƒ¨åˆ†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E5%81%9A%E9%83%A8%E5%88%86"><span class="nav-text">é€‰åšéƒ¨åˆ†</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E9%A2%9D%E5%A4%96%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="nav-text">äºŒã€é¢å¤–å®ç°çš„åŠŸèƒ½</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C"><span class="nav-text">ä¸‰ã€å®éªŒç»“æœ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-9-%E5%AE%9E%E7%8E%B0"><span class="nav-text">3.9 å®ç°&gt;&gt;</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%AE%9E%E9%AA%8C%E9%9A%BE%E7%82%B9%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">å››ã€å®éªŒéš¾ç‚¹åŠè§£å†³æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%AE%9E%E9%AA%8C%E4%BD%93%E4%BC%9A"><span class="nav-text">äº”ã€å®éªŒä½“ä¼š</span></a></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2022</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">jkm</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        å…± 15 ç¯‡æ–‡ç« 
                    </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">è®¿é—®äººæ•°</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">æ€»è®¿é—®é‡</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">ç”± <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="åœ–å±¤_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> é©±åŠ¨</span>
            <span class="text-sm lg:block">ä¸»é¢˜&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.6.4</a></span>
        </div>
        
        
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>


    <script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/libs/Swup.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/libs/SwupSlideTheme.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/libs/SwupScriptsPlugin.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/libs/SwupProgressPlugin.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/libs/SwupScrollPlugin.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/libs/SwupPreloadPlugin.min.js"></script>
<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>






<script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/tools/imageViewer.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/utils.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/main.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/layouts/navbarShrink.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/tools/scrollTopBottom.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/tools/lightDarkSwitch.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/layouts/categoryList.js"></script>


    <script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/tools/localSearch.js"></script>



    <script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/tools/codeBlock.js"></script>



    <script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/layouts/lazyload.js"></script>





  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/libs/Typed.min.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/plugins/typed.js"></script>








<div class="post-scripts" data-swup-reload-script>
    
        <script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/tools/tocToggle.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/layouts/toc.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.6.4/source/js/plugins/tabs.js"></script>
    
</div>


</body>
</html>
